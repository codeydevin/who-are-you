<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Driftfield Atlas</title>
  <style>
    :root {
      --ink: #14110f;
      --paper: #f8f3ea;
      --ember: #e07a5f;
      --river: #3d5a80;
      --glow: #f4d58d;
      --panel: #fff9f1;
      --line: rgba(20, 17, 15, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--ink);
      font-family: "Space Grotesk", "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 12% 18%, rgba(244, 213, 141, 0.55), transparent 45%),
        radial-gradient(circle at 88% 10%, rgba(224, 122, 95, 0.25), transparent 52%),
        linear-gradient(140deg, #fef8ef 0%, #f2e8d9 60%, #e7ddcf 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      animation: rise 750ms ease-out;
    }

    .shell {
      width: min(1100px, 95vw);
      border-radius: 28px;
      background: rgba(255, 249, 241, 0.88);
      border: 1px solid var(--line);
      box-shadow: 0 24px 70px rgba(31, 26, 22, 0.18);
      padding: 28px;
      backdrop-filter: blur(6px);
    }

    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 14px;
      align-items: baseline;
    }

    h1 {
      margin: 0;
      font-family: "Fraunces", "Times New Roman", serif;
      font-size: clamp(1.8rem, 2.8vw, 2.5rem);
      letter-spacing: 0.03em;
    }

    .subtitle {
      color: var(--river);
      font-size: 0.95rem;
    }

    .grid {
      margin-top: 22px;
      display: grid;
      grid-template-columns: minmax(250px, 320px) 1fr;
      gap: 20px;
    }

    .panel {
      background: var(--panel);
      border-radius: 20px;
      border: 1px solid var(--line);
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(20, 17, 15, 0.7);
      display: block;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="number"],
    input[type="range"] {
      width: 100%;
      font-family: inherit;
    }

    input[type="text"],
    input[type="number"] {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(20, 17, 15, 0.18);
      background: #fff;
    }

    .range-row {
      display: grid;
      grid-template-columns: 1fr 70px;
      align-items: center;
      gap: 10px;
    }

    .range-row span {
      font-size: 0.85rem;
      color: rgba(20, 17, 15, 0.7);
      text-align: right;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-family: inherit;
      cursor: pointer;
      color: #fff;
      background: var(--river);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    button.secondary {
      background: var(--ember);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(61, 90, 128, 0.25);
    }

    .output {
      background: #14110f;
      color: #f7efe2;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(244, 213, 141, 0.2);
      font-family: "IBM Plex Mono", "Courier New", monospace;
      font-size: 12px;
      line-height: 1.25;
      white-space: pre;
      overflow-x: auto;
      min-height: 360px;
    }

    .stats {
      font-family: "IBM Plex Mono", "Courier New", monospace;
      font-size: 0.85rem;
      color: rgba(20, 17, 15, 0.8);
      white-space: pre;
    }

    .footer {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      color: rgba(20, 17, 15, 0.7);
      font-size: 0.85rem;
    }

    @media (max-width: 860px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div>
        <h1>Driftfield Atlas</h1>
        <div class="subtitle">Atlas-grade driftfield textures with glyph telemetry.</div>
      </div>
      <div class="subtitle">Mode: interactive web toy</div>
    </header>

    <section class="grid">
      <div class="panel">
        <div>
          <label for="seed">Seed phrase</label>
          <input id="seed" type="text" value="tide observatory" />
        </div>
        <div>
          <label for="alphabet">Glyph ramp</label>
          <input id="alphabet" type="text" value=".,:;~^*+=?%$#@" />
        </div>
        <div>
          <label for="rows">Rows</label>
          <input id="rows" type="number" min="10" max="40" value="20" />
        </div>
        <div>
          <label for="cols">Columns</label>
          <input id="cols" type="number" min="30" max="120" value="64" />
        </div>
        <div>
          <label for="contrast">Contrast</label>
          <div class="range-row">
            <input id="contrast" type="range" min="0.6" max="2.4" step="0.05" value="1.2" />
            <span id="contrastValue">1.2</span>
          </div>
        </div>
        <div>
          <label for="warp">Warp</label>
          <div class="range-row">
            <input id="warp" type="range" min="0" max="4" step="0.1" value="1.8" />
            <span id="warpValue">1.8</span>
          </div>
        </div>
        <div>
          <label for="tide">Tide phase</label>
          <div class="range-row">
            <input id="tide" type="range" min="0" max="6.28" step="0.05" value="2.1" />
            <span id="tideValue">2.1</span>
          </div>
        </div>
        <div>
          <button id="generate">Generate Atlas</button>
          <button class="secondary" id="shuffle">Shuffle Seed</button>
        </div>
        <div class="stats" id="stats"></div>
      </div>

      <div class="panel">
        <pre class="output" id="output"></pre>
        <div class="footer">
          <button id="copy">Copy Output</button>
          <div id="status">Ready.</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const hashSeed = (text) => {
      let h = 2166136261;
      for (let i = 0; i < text.length; i++) {
        h ^= text.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    };

    const lcg = (seed) => {
      let state = seed >>> 0;
      return () => {
        state = (1664525 * state + 1013904223) >>> 0;
        return state / 0xffffffff;
      };
    };

    const smooth = (t) => t * t * (3 - 2 * t);

    const valueNoise = (x, y, rand) => {
      const x0 = Math.floor(x);
      const y0 = Math.floor(y);
      const x1 = x0 + 1;
      const y1 = y0 + 1;

      const sx = smooth(x - x0);
      const sy = smooth(y - y0);

      const v00 = rand(x0, y0);
      const v10 = rand(x1, y0);
      const v01 = rand(x0, y1);
      const v11 = rand(x1, y1);

      const ix0 = v00 + (v10 - v00) * sx;
      const ix1 = v01 + (v11 - v01) * sx;
      return ix0 + (ix1 - ix0) * sy;
    };

    const makeRand2 = (seed) => {
      const base = lcg(seed);
      return (x, y) => {
        const n = x * 374761393 + y * 668265263;
        const step = (n ^ seed) >>> 0;
        const spin = lcg(step ^ (base() * 0xffffffff));
        return spin();
      };
    };

    const generateField = ({ seedPhrase, rows, cols, contrast, warp, tide, alphabet }) => {
      const seed = hashSeed(`${seedPhrase}::${alphabet}`);
      const rand2 = makeRand2(seed);
      const field = [];
      const counts = new Map();

      for (const glyph of alphabet) {
        counts.set(glyph, 0);
      }

      for (let y = 0; y < rows; y++) {
        let line = "";
        for (let x = 0; x < cols; x++) {
          const nx = x / cols * 4;
          const ny = y / rows * 4;
          const warpX = nx + Math.sin(ny * 1.7 + seed * 0.0004 + tide) * warp * 0.3;
          const warpY = ny + Math.cos(nx * 1.3 + seed * 0.0003 - tide) * warp * 0.3;
          const base = valueNoise(warpX, warpY, rand2);
          const flow = (Math.sin((nx + ny) * 1.2 + tide * 2.0) + 1) / 2;
          const mixed = base * 0.7 + flow * 0.3;
          const tuned = Math.pow(Math.min(1, Math.max(0, mixed)), 1 / contrast);
          const idx = Math.min(alphabet.length - 1, Math.floor(tuned * alphabet.length));
          const glyph = alphabet[idx];
          line += glyph;
          counts.set(glyph, (counts.get(glyph) || 0) + 1);
        }
        field.push(line);
      }

      return {
        art: field.join("\n"),
        counts
      };
    };

    const seedEl = document.getElementById("seed");
    const alphabetEl = document.getElementById("alphabet");
    const rowsEl = document.getElementById("rows");
    const colsEl = document.getElementById("cols");
    const contrastEl = document.getElementById("contrast");
    const warpEl = document.getElementById("warp");
    const tideEl = document.getElementById("tide");
    const contrastValueEl = document.getElementById("contrastValue");
    const warpValueEl = document.getElementById("warpValue");
    const tideValueEl = document.getElementById("tideValue");
    const outputEl = document.getElementById("output");
    const statsEl = document.getElementById("stats");
    const statusEl = document.getElementById("status");

    const renderStats = (counts, total, alphabet) => {
      const lines = ["Glyph usage"];
      const items = alphabet.split("").map((glyph) => {
        const count = counts.get(glyph) || 0;
        return { glyph, count, ratio: count / total };
      });
      items.sort((a, b) => b.count - a.count);
      for (const item of items) {
        const barLen = Math.round(item.ratio * 20);
        const bar = "#".repeat(Math.max(1, barLen));
        const pct = (item.ratio * 100).toFixed(1).padStart(5, " ");
        lines.push(`${item.glyph} ${pct}% ${bar}`);
      }
      lines.push("");
      lines.push(`Cells: ${total}`);
      lines.push(`Palette: ${alphabet}`);
      return lines.join("\n");
    };

    const render = () => {
      const alphabet = alphabetEl.value.trim() || ".,:;~^*+=?%$#@";
      const rows = Number(rowsEl.value);
      const cols = Number(colsEl.value);
      const contrast = Number(contrastEl.value);
      const warp = Number(warpEl.value);
      const tide = Number(tideEl.value);

      contrastValueEl.textContent = contrast.toFixed(2);
      warpValueEl.textContent = warp.toFixed(1);
      tideValueEl.textContent = tide.toFixed(2);

      const { art, counts } = generateField({
        seedPhrase: seedEl.value.trim() || "tide observatory",
        rows,
        cols,
        contrast,
        warp,
        tide,
        alphabet
      });

      outputEl.textContent = art;
      statsEl.textContent = renderStats(counts, rows * cols, alphabet);
    };

    document.getElementById("generate").addEventListener("click", render);
    document.getElementById("shuffle").addEventListener("click", () => {
      const seeds = [
        "tide observatory",
        "harbor atlas",
        "ember corridor",
        "quiet telegraph",
        "stone drift",
        "silt horizon"
      ];
      seedEl.value = seeds[Math.floor(Math.random() * seeds.length)];
      render();
    });

    document.getElementById("copy").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(outputEl.textContent);
        statusEl.textContent = "Copied driftfield to clipboard.";
      } catch (err) {
        statusEl.textContent = "Clipboard unavailable. Select and copy manually.";
      }
    });

    [seedEl, alphabetEl, rowsEl, colsEl, contrastEl, warpEl, tideEl].forEach((el) => {
      el.addEventListener("input", render);
    });

    render();
  </script>
</body>
</html>
