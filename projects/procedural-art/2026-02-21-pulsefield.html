<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pulsefield: Drift-Controlled Weave</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=IBM+Plex+Mono:wght@400;600&display=swap");

    :root {
      --ink: #0f1417;
      --mist: #f2efe9;
      --sun: #f6b25b;
      --sea: #2e6f95;
      --rose: #c97b84;
      --grass: #2f8f73;
      --paper: #f7f2e8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 15% 20%, rgba(246, 178, 91, 0.35), transparent 45%),
        radial-gradient(circle at 85% 30%, rgba(46, 111, 149, 0.25), transparent 50%),
        linear-gradient(135deg, #f9f1df 0%, #f0ebe2 40%, #efe9f2 100%);
      color: var(--ink);
      font-family: "Space Grotesk", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
    }

    .shell {
      width: min(1100px, 96vw);
      display: grid;
      grid-template-columns: minmax(240px, 320px) minmax(0, 1fr);
      gap: 24px;
      align-items: start;
    }

    .panel {
      background: rgba(247, 242, 232, 0.78);
      border: 1px solid rgba(15, 20, 23, 0.1);
      border-radius: 18px;
      padding: 18px 18px 22px;
      box-shadow: 0 18px 45px rgba(15, 20, 23, 0.12);
      backdrop-filter: blur(6px);
    }

    h1 {
      margin: 0 0 10px;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
    }

    p {
      margin: 0 0 14px;
      line-height: 1.4;
      color: rgba(15, 20, 23, 0.75);
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin: 14px 0 6px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(15, 20, 23, 0.7);
    }

    input[type="text"],
    input[type="range"],
    select {
      width: 100%;
      font-family: "IBM Plex Mono", monospace;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(15, 20, 23, 0.2);
      background: #fffdf8;
    }

    input[type="range"] {
      padding: 0;
      background: transparent;
    }

    .actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 600;
      font-family: "Space Grotesk", sans-serif;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button.primary {
      background: var(--ink);
      color: var(--mist);
    }

    button.secondary {
      background: #ffffff;
      color: var(--ink);
      border: 1px solid rgba(15, 20, 23, 0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(15, 20, 23, 0.18);
    }

    .canvas-wrap {
      position: relative;
      background: #0f1417;
      border-radius: 22px;
      overflow: hidden;
      min-height: 560px;
      box-shadow: 0 18px 50px rgba(15, 20, 23, 0.25);
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .caption {
      position: absolute;
      left: 20px;
      bottom: 18px;
      background: rgba(247, 242, 232, 0.9);
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-family: "IBM Plex Mono", monospace;
      box-shadow: 0 12px 25px rgba(15, 20, 23, 0.2);
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: 1fr;
      }
      .canvas-wrap {
        min-height: 420px;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <section class="panel">
      <h1>Pulsefield</h1>
      <p>A deterministic weave generator. Adjust density, jitter, and drift. Every seed becomes a distinct pulse map.</p>

      <label for="seed">Seed phrase</label>
      <input id="seed" type="text" value="quiet ignition" />

      <label for="density">Density</label>
      <input id="density" type="range" min="12" max="60" value="36" />

      <label for="jitter">Jitter</label>
      <input id="jitter" type="range" min="0" max="30" value="12" />

      <label for="drift">Drift angle</label>
      <input id="drift" type="range" min="-45" max="45" value="-12" />

      <label for="palette">Palette</label>
      <select id="palette">
        <option value="ember">Ember / Sea</option>
        <option value="orchard">Orchard / Rose</option>
        <option value="tide">Tide / Mist</option>
      </select>

      <div class="actions">
        <button class="primary" id="render">Render</button>
        <button class="secondary" id="shuffle">Shuffle Seed</button>
      </div>
    </section>

    <section class="canvas-wrap">
      <canvas id="canvas" width="900" height="600"></canvas>
      <div class="caption" id="caption">Seed: quiet ignition</div>
    </section>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const seedInput = document.getElementById("seed");
    const densityInput = document.getElementById("density");
    const jitterInput = document.getElementById("jitter");
    const driftInput = document.getElementById("drift");
    const paletteInput = document.getElementById("palette");
    const caption = document.getElementById("caption");

    const palettes = {
      ember: ["#f6b25b", "#2e6f95", "#0f1417"],
      orchard: ["#f3c08a", "#c97b84", "#2f3e46"],
      tide: ["#9db4c0", "#f7f2e8", "#223843"],
    };

    function hashSeed(str) {
      let h = 2166136261 >>> 0;
      for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    }

    function mulberry32(a) {
      return function () {
        let t = (a += 0x6d2b79f5);
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
    }

    function render() {
      resizeCanvas();
      const seed = seedInput.value.trim() || "silent current";
      const density = parseInt(densityInput.value, 10);
      const jitter = parseInt(jitterInput.value, 10);
      const drift = (parseInt(driftInput.value, 10) * Math.PI) / 180;
      const palette = palettes[paletteInput.value] || palettes.ember;

      const rng = mulberry32(hashSeed(seed));
      const cols = density;
      const rows = Math.round(density * 0.66);
      const cellW = canvas.clientWidth / cols;
      const cellH = canvas.clientHeight / rows;

      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
      ctx.fillStyle = palette[2];
      ctx.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const baseX = x * cellW;
          const baseY = y * cellH;
          const wobble = (rng() - 0.5) * jitter;
          const tiltX = Math.cos(drift) * wobble;
          const tiltY = Math.sin(drift) * wobble;
          const tone = rng();
          const color = tone > 0.66 ? palette[0] : tone > 0.33 ? palette[1] : "#f7f2e8";
          const alpha = 0.35 + rng() * 0.55;

          ctx.fillStyle = color + Math.floor(alpha * 255).toString(16).padStart(2, "0");
          ctx.fillRect(baseX + tiltX, baseY + tiltY, cellW * (0.6 + rng() * 0.6), cellH * (0.6 + rng() * 0.6));
        }
      }

      caption.textContent = `Seed: ${seed} | Density ${density} | Drift ${driftInput.value}`;
    }

    function shuffleSeed() {
      const fragments = ["quiet", "ember", "tide", "hinge", "azure", "moss", "sable", "signal", "woven", "comet"];
      const pick = () => fragments[Math.floor(Math.random() * fragments.length)];
      seedInput.value = `${pick()} ${pick()}`;
      render();
    }

    document.getElementById("render").addEventListener("click", render);
    document.getElementById("shuffle").addEventListener("click", shuffleSeed);
    window.addEventListener("resize", render);

    render();
  </script>
</body>
</html>
